<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SnapCode Ultimate | HTML to Image Studio</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- html-to-image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.js"></script>

    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Poppins:wght@400;600;800&family=Roboto:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Poppins', 'sans-serif'],
                    },
                    fontSize: {
                        'xxs': '0.6rem',
                    },
                    colors: {
                        gray: {
                            750: '#2d3748',
                            850: '#1a202c',
                            950: '#0d1117',
                        },
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #e2e8f0;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #0f0f0f;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* Checkerboard Background */
        .checkerboard {
            background-color: #111;
            background-image:
                linear-gradient(45deg, #1a1a1a 25%, transparent 25%),
                linear-gradient(-45deg, #1a1a1a 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #1a1a1a 75%),
                linear-gradient(-45deg, transparent 75%, #1a1a1a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -4px;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #333;
            border-radius: 2px;
        }

        .code-editor {
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
            tab-size: 2;
        }

        [contenteditable]:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }

        .preserve-3d {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        /* Pattern Classes */
        .pattern-grid {
            background-image: radial-gradient(#ffffff 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .pattern-noise {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* Smooth Sidebar Transitions */
        #left-panel,
        #right-panel {
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Floating Button Transition */
        #left-toggle-btn,
        #right-toggle-btn {
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1), right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body
    class="h-screen flex flex-col overflow-hidden bg-black font-sans antialiased selection:bg-blue-500/30 text-[10px] sm:text-xs md:text-sm">

    <!-- Navbar -->
    <header
        class="h-12 md:h-14 bg-[#0a0a0a] border-b border-[#222] flex items-center justify-between px-3 md:px-5 z-30 shrink-0">
        <div class="flex items-center gap-2 md:gap-3">
            <div
                class="w-7 h-7 md:w-8 md:h-8 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/20 ring-1 ring-white/10">
                <i class="fa-solid fa-cube text-white text-[10px] md:text-xs"></i>
            </div>
            <div class="hidden sm:block">
                <h1 class="font-display font-bold text-sm tracking-tight text-white leading-none">SnapCode</h1>
                <span class="text-[9px] font-medium text-blue-500 uppercase tracking-widest">Ultimate</span>
            </div>
        </div>

        <!-- Mode Switcher -->
        <div class="flex items-center bg-[#151515] p-0.5 md:p-1 rounded-lg border border-[#222]">
            <button onclick="setMode('editor')" id="btn-mode-editor"
                class="px-3 md:px-5 py-1 md:py-1.5 text-[9px] md:text-xs font-medium rounded transition-all bg-[#252525] text-white shadow-sm ring-1 ring-white/5">
                <i class="fa-solid fa-code mr-1.5"></i><span class="hidden sm:inline">Design</span>
            </button>
            <button onclick="setMode('url')" id="btn-mode-url"
                class="px-3 md:px-5 py-1 md:py-1.5 text-[9px] md:text-xs font-medium rounded transition-all text-gray-500 hover:text-white">
                <i class="fa-solid fa-earth-americas mr-1.5"></i><span class="hidden sm:inline">URL Snap</span>
            </button>
        </div>

        <!-- Right Actions -->
        <div class="flex items-center gap-2 md:gap-3" id="header-actions">
            <button onclick="toggleTilt()" id="btn-tilt"
                class="w-7 h-7 md:w-8 md:h-8 rounded-lg bg-[#151515] border border-[#222] text-gray-400 hover:text-white hover:border-blue-500/50 transition-colors flex items-center justify-center"
                title="Toggle 3D View">
                <i class="fa-solid fa-cubes-stacked text-[10px] md:text-xs"></i>
            </button>

            <div class="h-4 w-px bg-[#222]"></div>

            <button onclick="copyToClipboard()"
                class="bg-[#151515] hover:bg-[#202020] border border-[#222] text-gray-300 hover:text-white px-3 py-1.5 rounded-lg text-[10px] md:text-xs font-semibold transition-all flex items-center gap-2">
                <i class="fa-regular fa-copy"></i> <span class="hidden md:inline">Copy</span>
            </button>

            <button onclick="exportImage()"
                class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded-lg text-[10px] md:text-xs font-bold shadow-lg shadow-blue-600/20 transition-all flex items-center gap-2 ring-1 ring-white/10">
                <i class="fa-solid fa-download"></i> <span class="hidden md:inline">Export</span>
            </button>
        </div>
    </header>

    <!-- Main Workspace (Container for Panels & Canvas) -->
    <div class="flex-1 flex overflow-hidden relative">

        <!-- LEFT PANEL: Code Editor -->
        <aside id="left-panel"
            class="w-0 bg-[#0a0a0a] border-[#222] flex flex-col shrink-0 z-20 overflow-hidden absolute md:static h-full left-0 top-0 bottom-0 shadow-2xl md:shadow-none transition-all border-r-0 pb-12 md:pb-0">
            <div class="flex items-center justify-between px-4 py-3 border-b border-[#222] bg-[#0a0a0a] min-w-[320px]">
                <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Source Code</span>
                <button onclick="formatCode()"
                    class="text-[10px] font-medium text-gray-400 hover:text-blue-400 flex items-center gap-1 transition-colors">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> <span class="hidden sm:inline">Format</span>
                </button>
            </div>

            <div class="flex-1 relative group bg-[#050505] min-w-[320px]">
                <textarea id="code-input"
                    class="code-editor w-full h-full bg-transparent text-gray-300 p-4 text-xs resize-none focus:outline-none placeholder-gray-700"
                    spellcheck="false" placeholder="<!-- Write your HTML here -->"></textarea>
            </div>

            <!-- Templates -->
            <div class="h-auto border-t border-[#222] bg-[#0e0e0e] p-4 min-w-[320px]">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Templates</span>
                    <span class="text-[10px] text-gray-600 cursor-pointer hover:text-gray-400"
                        onclick="loadTemplate('default')">Reset</span>
                </div>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="loadTemplate('gradient-card')"
                        class="h-9 rounded-lg bg-gradient-to-br from-pink-500 to-orange-400 hover:opacity-90 ring-1 ring-white/10 hover:ring-white/30 transition-all"></button>
                    <button onclick="loadTemplate('code-snippet')"
                        class="h-9 rounded-lg bg-[#1a1a1a] border border-[#333] flex items-center justify-center hover:bg-[#252525] hover:border-blue-500/50 transition-all">
                        <i class="fa-solid fa-code text-gray-500 text-xs"></i>
                    </button>
                    <button onclick="loadTemplate('quote')"
                        class="h-9 rounded-lg bg-white flex items-center justify-center hover:bg-gray-200 transition-all">
                        <i class="fa-solid fa-quote-right text-black text-xs"></i>
                    </button>
                    <button onclick="loadTemplate('glass-morphism')"
                        class="h-9 rounded-lg bg-gray-800 border border-gray-600 flex items-center justify-center hover:bg-gray-700 transition-all relative overflow-hidden">
                        <div class="absolute inset-0 bg-white/10 backdrop-blur-sm"></div>
                        <i class="fa-solid fa-layer-group text-white relative z-10 text-xs"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Sidebar Toggles (Desktop: Floating Arrows, Mobile: Hidden) -->
        <button onclick="toggleLeftPanel()" id="left-toggle-btn"
            class="hidden md:flex absolute top-1/2 transform -translate-y-1/2 z-50 w-6 h-12 bg-[#1a1a1a] border-y border-r border-[#333] rounded-r-xl text-gray-400 hover:text-blue-400 hover:bg-[#222] items-center justify-center shadow-lg cursor-pointer group"
            style="left: 0;">
            <i class="fa-solid fa-chevron-right text-[10px] group-hover:scale-110 transition-transform"
                id="left-chevron"></i>
        </button>

        <button onclick="toggleRightPanel()" id="right-toggle-btn"
            class="hidden md:flex absolute top-1/2 transform -translate-y-1/2 z-50 w-6 h-12 bg-[#1a1a1a] border-y border-l border-[#333] rounded-l-xl text-gray-400 hover:text-blue-400 hover:bg-[#222] items-center justify-center shadow-lg cursor-pointer group"
            style="right: 0;">
            <i class="fa-solid fa-chevron-left text-[10px] group-hover:scale-110 transition-transform"
                id="right-chevron"></i>
        </button>

        <!-- CENTER PANEL: Canvas -->
        <main
            class="flex-1 bg-[#050505] relative overflow-hidden flex flex-col items-center justify-center z-0 checkerboard transition-all"
            id="canvas-area">

            <!-- URL Input Bar -->
            <div id="url-input-bar"
                class="hidden absolute top-4 md:top-6 left-1/2 transform -translate-x-1/2 z-40 w-[90%] max-w-lg">
                <div
                    class="flex gap-0 shadow-2xl shadow-black/50 rounded-xl overflow-hidden ring-1 ring-white/10 animate-float bg-[#111]">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-globe text-gray-500 text-xs"></i>
                    </div>
                    <input type="url" id="url-input" placeholder="Enter website URL (e.g. apple.com)"
                        class="flex-1 bg-[#151515] text-white pl-9 pr-4 py-3 focus:outline-none placeholder-gray-600 font-mono text-xs"
                        onkeydown="if(event.key === 'Enter') fetchUrlScreenshot()">
                    <button onclick="fetchUrlScreenshot()" id="btn-snap"
                        class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-3 font-bold text-xs transition-colors border-l border-blue-700 flex items-center gap-2">
                        <span>Snap</span>
                        <i class="fa-solid fa-camera"></i>
                    </button>
                </div>
                <div id="url-loading-bar" class="hidden w-full h-1 bg-[#151515] mt-2 overflow-hidden rounded-full">
                    <div class="h-full bg-blue-500 animate-[width_2s_ease-in-out_infinite] w-1/3 rounded-full"></div>
                </div>
            </div>

            <!-- HTML DESIGN CANVAS -->
            <div id="scale-wrapper"
                class="transform transition-transform duration-200 origin-center ease-out will-change-transform preserve-3d p-8">
                <div id="export-container"
                    class="transition-all duration-300 ease-out shadow-2xl overflow-hidden flex flex-col relative max-w-full"
                    style="width: 800px; min-height: 400px; background: #ffffff;">
                    <div id="bg-pattern-layer" class="absolute inset-0 pointer-events-none opacity-50 z-0"></div>
                    <div id="window-chrome"
                        class="relative z-10 bg-[#1a1a1a] px-5 py-3 flex items-center border-b border-white/5 shrink-0 transition-colors">
                        <div class="flex gap-2">
                            <div class="w-3 h-3 rounded-full bg-[#ff5f56] shadow-sm"></div>
                            <div class="w-3 h-3 rounded-full bg-[#ffbd2e] shadow-sm"></div>
                            <div class="w-3 h-3 rounded-full bg-[#27c93f] shadow-sm"></div>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <span id="window-title"
                                class="text-[11px] font-medium text-gray-500 pointer-events-auto cursor-text px-2 py-0.5 rounded hover:bg-white/5 transition-colors"
                                contenteditable="true" spellcheck="false">untitled.html</span>
                        </div>
                    </div>
                    <div id="content-area" class="w-full h-full flex-1 relative z-10 flex flex-col"></div>
                </div>
            </div>

            <!-- Zoom Controls (Moved up for Mobile) -->
            <div
                class="absolute bottom-16 md:bottom-6 left-1/2 transform -translate-x-1/2 bg-[#1a1a1a]/90 backdrop-blur-md border border-[#333] rounded-full px-4 py-1.5 flex items-center gap-4 shadow-2xl z-20">
                <button onclick="updateZoom(-0.1)" class="text-gray-400 hover:text-white transition-colors"><i
                        class="fa-solid fa-minus text-[10px]"></i></button>
                <span id="zoom-label"
                    class="text-[10px] font-mono text-gray-300 w-8 text-center select-none">100%</span>
                <button onclick="updateZoom(0.1)" class="text-gray-400 hover:text-white transition-colors"><i
                        class="fa-solid fa-plus text-[10px]"></i></button>
            </div>
        </main>

        <!-- RIGHT PANEL: Properties -->
        <aside id="right-panel"
            class="w-0 bg-[#0a0a0a] border-[#222] flex flex-col overflow-y-auto shrink-0 z-20 custom-scrollbar pb-16 md:pb-10 absolute md:static right-0 top-0 bottom-0 h-full shadow-2xl md:shadow-none transition-all border-l-0">

            <!-- Dimensions -->
            <div class="p-5 border-b border-[#222] min-w-[320px]">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Canvas</h3>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="resizeCanvas(1080, 1080)"
                        class="px-3 py-2 bg-[#151515] hover:bg-[#202020] rounded-md border border-[#333] text-[10px] text-gray-400 hover:text-white text-left transition-colors flex items-center gap-2">
                        <i class="fa-brands fa-instagram"></i> Square
                    </button>
                    <button onclick="resizeCanvas(1200, 630)"
                        class="px-3 py-2 bg-[#151515] hover:bg-[#202020] rounded-md border border-[#333] text-[10px] text-gray-400 hover:text-white text-left transition-colors flex items-center gap-2">
                        <i class="fa-brands fa-twitter"></i> Twitter
                    </button>
                </div>
                <div class="flex gap-2 items-center">
                    <div class="relative flex-1">
                        <span class="absolute left-3 top-2 text-gray-600 text-[10px] font-bold">W</span>
                        <input type="number" id="input-width" value="800"
                            class="w-full bg-[#111] border border-[#333] rounded-md py-1.5 pl-8 pr-2 text-[10px] text-gray-300 focus:border-blue-500 focus:outline-none transition-colors"
                            onchange="updateDimensions()">
                    </div>
                    <span class="text-gray-600 text-xs">Ã—</span>
                    <div class="relative flex-1">
                        <span class="absolute left-3 top-2 text-gray-600 text-[10px] font-bold">H</span>
                        <input type="number" id="input-height" value="auto"
                            class="w-full bg-[#111] border border-[#333] rounded-md py-1.5 pl-8 pr-2 text-[10px] text-gray-500 focus:border-blue-500 focus:outline-none cursor-not-allowed opacity-60"
                            disabled placeholder="Auto">
                    </div>
                </div>
            </div>

            <!-- Appearance -->
            <div class="p-5 border-b border-[#222] min-w-[320px]">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Background</h3>

                <!-- Background Picker -->
                <div class="grid grid-cols-5 gap-2 mb-4">
                    <div onclick="setBg('transparent')"
                        class="h-8 w-8 rounded-full border border-gray-600 cursor-pointer checkerboard hover:ring-2 hover:ring-white/50 transition-all"
                        title="Transparent"></div>
                    <div onclick="setBg('#000000')"
                        class="h-8 w-8 rounded-full bg-black border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all"
                        title="Black"></div>
                    <div onclick="setBg('#ffffff')"
                        class="h-8 w-8 rounded-full bg-white border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all"
                        title="White"></div>
                    <div onclick="setBg('linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-br from-[#1e1e2e] to-[#2a2a3e] border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                    <div onclick="setBg('linear-gradient(to right, #4facfe 0%, #00f2fe 100%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-r from-blue-400 to-cyan-300 border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                    <div onclick="setBg('linear-gradient(135deg, #667eea 0%, #764ba2 100%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-700 border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                    <div onclick="setBg('linear-gradient(to right, #f83600 0%, #f9d423 100%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-r from-orange-500 to-yellow-400 border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                    <div onclick="setBg('linear-gradient(109.6deg, rgba(223,234,247,1) 11.2%, rgba(244,248,252,1) 91.1%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-br from-gray-200 to-white border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                    <div onclick="setBg('linear-gradient(to top, #30cfd0 0%, #330867 100%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-t from-teal-400 to-purple-900 border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                    <div onclick="setBg('radial-gradient(circle at 10% 20%, rgb(0, 0, 0) 0%, rgb(64, 64, 64) 90.2%)')"
                        class="h-8 w-8 rounded-full bg-gradient-to-br from-black to-gray-700 border border-gray-700 cursor-pointer hover:ring-2 hover:ring-white/50 transition-all">
                    </div>
                </div>

                <!-- Padding -->
                <div class="mb-4">
                    <div class="flex justify-between mb-2">
                        <label class="text-[10px] text-gray-400 font-medium">Padding</label>
                        <span id="val-padding" class="text-[10px] text-gray-500 font-mono">48px</span>
                    </div>
                    <input type="range" min="0" max="120" value="48" oninput="updateStyle('padding', this.value)">
                </div>

                <!-- Pattern Selector -->
                <div>
                    <label class="text-[10px] text-gray-400 font-medium mb-2 block">Overlay Pattern</label>
                    <div class="flex gap-2">
                        <button onclick="setPattern('none')"
                            class="flex-1 py-1.5 text-[10px] bg-[#151515] border border-[#333] rounded hover:border-gray-500 text-gray-400 hover:text-white transition-colors">None</button>
                        <button onclick="setPattern('pattern-grid')"
                            class="flex-1 py-1.5 text-[10px] bg-[#151515] border border-[#333] rounded hover:border-gray-500 text-gray-400 hover:text-white transition-colors">Grid</button>
                        <button onclick="setPattern('pattern-noise')"
                            class="flex-1 py-1.5 text-[10px] bg-[#151515] border border-[#333] rounded hover:border-gray-500 text-gray-400 hover:text-white transition-colors">Noise</button>
                    </div>
                </div>
            </div>

            <!-- Typography -->
            <div class="p-5 border-b border-[#222] min-w-[320px]">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Typography</h3>
                <label class="text-[10px] text-gray-400 font-medium mb-2 block">Font Family</label>
                <select onchange="updateFont(this.value)"
                    class="w-full bg-[#151515] border border-[#333] text-gray-300 text-[10px] rounded-md p-2 focus:outline-none focus:border-blue-500">
                    <option value="'Inter', sans-serif">Inter (Sans)</option>
                    <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                    <option value="'Poppins', sans-serif">Poppins (Display)</option>
                    <option value="'Roboto', sans-serif">Roboto</option>
                    <option value="'Lato', sans-serif">Lato</option>
                    <option value="'Montserrat', sans-serif">Montserrat</option>
                </select>
            </div>

            <!-- Frame -->
            <div class="p-5 border-b border-[#222] min-w-[320px]">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Window</h3>

                <div class="flex items-center justify-between mb-4 group cursor-pointer" onclick="toggleWindowChrome()">
                    <label class="text-[10px] text-gray-400 group-hover:text-gray-300 cursor-pointer">Show
                        Header</label>
                    <div id="btn-chrome" class="w-8 h-4 bg-[#333] rounded-full relative transition-colors">
                        <div class="absolute left-1 top-0.5 w-3 h-3 bg-white rounded-full transition-transform"></div>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-4 group cursor-pointer" onclick="toggleDarkMode()">
                    <label class="text-[10px] text-gray-400 group-hover:text-gray-300 cursor-pointer">Dark Mode</label>
                    <div id="btn-dark" class="w-8 h-4 bg-[#333] rounded-full relative transition-colors">
                        <div class="absolute left-1 top-0.5 w-3 h-3 bg-white rounded-full transition-transform"></div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="flex justify-between mb-2">
                        <label class="text-[10px] text-gray-400 font-medium">Roundness</label>
                        <span id="val-radius" class="text-[10px] text-gray-500 font-mono">12px</span>
                    </div>
                    <input type="range" min="0" max="40" value="12" oninput="updateStyle('radius', this.value)">
                </div>

                <!-- Shadow -->
                <div>
                    <label class="text-[10px] text-gray-400 font-medium mb-2 block">Shadow Depth</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setShadow('none')" id="shadow-none"
                            class="py-1.5 text-[10px] rounded border border-[#333] text-gray-400 hover:text-white transition-colors">None</button>
                        <button onclick="setShadow('md')" id="shadow-md"
                            class="py-1.5 text-[10px] rounded border border-[#333] text-gray-400 hover:text-white transition-colors">Medium</button>
                        <button onclick="setShadow('xl')" id="shadow-xl"
                            class="py-1.5 text-[10px] rounded border border-[#333] text-gray-400 hover:text-white transition-colors">Heavy</button>
                    </div>
                </div>
            </div>

            <!-- Export Settings -->
            <div class="p-5 min-w-[320px]">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-4">Export Quality</h3>
                <div class="flex gap-2">
                    <button onclick="setScale(1)" id="scale-1"
                        class="flex-1 py-1.5 text-[10px] bg-[#151515] border border-[#333] rounded hover:border-gray-500 text-gray-400 hover:text-white transition-colors">1x</button>
                    <button onclick="setScale(2)" id="scale-2"
                        class="flex-1 py-1.5 text-[10px] bg-blue-600 border border-blue-500 rounded text-white font-bold transition-colors">2x</button>
                    <button onclick="setScale(4)" id="scale-4"
                        class="flex-1 py-1.5 text-[10px] bg-[#151515] border border-[#333] rounded hover:border-gray-500 text-gray-400 hover:text-white transition-colors">4x</button>
                </div>
            </div>

        </aside>
    </div>

    <!-- Mobile Bottom Navigation Bar (Mobile Only) -->
    <div
        class="md:hidden fixed bottom-0 left-0 right-0 h-12 bg-[#0a0a0a] border-t border-[#222] z-50 flex items-center justify-between px-6">
        <button onclick="toggleLeftPanel()" id="mobile-left-btn"
            class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition-colors">
            <i class="fa-solid fa-code text-base"></i>
            <span class="text-[8px] font-medium tracking-wide">CODE</span>
        </button>

        <!-- Center Space - Optional for future use -->
        <div class="w-px h-6 bg-[#222]"></div>

        <button onclick="toggleRightPanel()" id="mobile-right-btn"
            class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition-colors">
            <i class="fa-solid fa-sliders text-base"></i>
            <span class="text-[8px] font-medium tracking-wide">DESIGN</span>
        </button>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed top-6 right-6 bg-[#1a1a1a] text-white px-4 py-3 rounded-lg shadow-2xl border border-[#333] transform translate-x-full transition-transform duration-300 flex items-center gap-3 z-50 max-w-[90vw]">
        <div id="toast-icon-container" class="w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center">
            <i class="fa-solid fa-check text-green-500 text-xs"></i>
        </div>
        <span id="toast-msg" class="text-xs font-medium truncate">Notification</span>
    </div>

    <script>
        // --- Templates Database ---
        const templates = {
            'default': `<div class="p-16 text-center h-full flex flex-col items-center justify-center">
    <div class="w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center mb-6 text-blue-500 text-2xl">
        <i class="fa-solid fa-wand-magic-sparkles"></i>
    </div>
    <h1 class="text-6xl font-extrabold tracking-tighter mb-4 text-gray-900 leading-tight">Create<br><span class="text-blue-600">Beautifully.</span></h1>
    <p class="text-xl text-gray-500 max-w-md font-light">Edit HTML on the left. Watch the magic happen on the right.</p>
</div>`,

            'gradient-card': `<div class="w-full h-full min-h-[400px] bg-gradient-to-br from-violet-600 to-indigo-600 rounded-2xl flex flex-col items-center justify-center p-10 text-white shadow-2xl relative overflow-hidden">
    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150"></div>
    <div class="relative z-10 text-center">
        <span class="inline-block px-3 py-1 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-xs font-bold mb-6 tracking-wide uppercase">New Release</span>
        <h2 class="text-5xl font-bold tracking-tight mb-4">SnapCode<br>Ultimate</h2>
        <p class="text-indigo-100 text-lg font-light mb-8 max-w-sm mx-auto">The most powerful HTML-to-Image converter just got a massive upgrade.</p>
        <div class="flex gap-4 justify-center">
            <div class="h-10 w-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/10"><i class="fa-brands fa-react"></i></div>
            <div class="h-10 w-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/10"><i class="fa-brands fa-html5"></i></div>
            <div class="h-10 w-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/10"><i class="fa-solid fa-bolt"></i></div>
        </div>
    </div>
</div>`,

            'code-snippet': `<div class="w-full">
<pre><code class="language-javascript">const createMagic = async () => {
    const idea = await brainstorm();
    
    // Transform thought into reality
    const result = new Project({
        name: 'SnapCode',
        version: 'Ultimate',
        status: 'Shipped ðŸš€'
    });

    return result.deploy();
}</code></pre>
</div>
<style>
    pre { margin: 0 !important; border-radius: 8px; background: #1e1e1e !important; text-shadow: none !important; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
</style>`,

            'glass-morphism': `<div class="w-full h-full min-h-[350px] bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 flex items-center justify-center p-10 relative overflow-hidden rounded-3xl">
    <div class="absolute top-10 left-10 w-32 h-32 bg-white rounded-full mix-blend-overlay filter blur-xl opacity-50 animate-pulse"></div>
    <div class="absolute bottom-10 right-10 w-48 h-48 bg-blue-500 rounded-full mix-blend-overlay filter blur-2xl opacity-50"></div>
    <div class="bg-white/10 backdrop-blur-xl border border-white/20 p-8 rounded-2xl shadow-xl max-w-sm w-full relative z-10">
        <div class="flex justify-between items-start mb-6">
            <div class="h-10 w-10 rounded-full bg-gradient-to-tr from-white/40 to-white/10 flex items-center justify-center text-white">
                <i class="fa-brands fa-cc-visa text-xl"></i>
            </div>
            <span class="text-white/80 font-mono tracking-widest text-xs">**** 4029</span>
        </div>
        <div class="mt-8">
            <p class="text-white/60 text-xs uppercase tracking-wider mb-1">Balance</p>
            <h3 class="text-white text-3xl font-bold">$24,093.20</h3>
        </div>
    </div>
</div>`,

            'quote': `<div class="bg-white p-12 border-l-8 border-black max-w-lg shadow-sm">
    <i class="fa-solid fa-quote-left text-6xl text-gray-100 mb-8 block"></i>
    <p class="text-3xl font-serif text-gray-900 italic leading-snug">
        "Simplicity is the ultimate sophistication."
    </p>
    <div class="mt-10 flex items-center gap-4">
        <div class="w-12 h-12 bg-gray-100 rounded-full overflow-hidden grayscale">
             <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=DaVinci" alt="avatar" crossorigin="anonymous">
        </div>
        <div>
            <p class="font-bold text-gray-900 text-sm tracking-wide uppercase">Leonardo da Vinci</p>
            <p class="text-gray-500 text-xs">Polymath</p>
        </div>
    </div>
</div>`
        };

        // --- State ---
        const state = {
            padding: 48,
            radius: 12,
            shadow: 'xl',
            chrome: true,
            darkChrome: true,
            zoom: 1.0,
            bg: 'linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%)',
            scale: 2,
            tilt: false,
            leftPanelOpen: true,
            rightPanelOpen: true,
            mode: 'editor' // 'editor' or 'url'
        };

        // --- DOM ---
        const els = {
            input: document.getElementById('code-input'),
            output: document.getElementById('content-area'),
            container: document.getElementById('export-container'),
            chrome: document.getElementById('window-chrome'),
            urlInputBar: document.getElementById('url-input-bar'),
            scaleWrapper: document.getElementById('scale-wrapper'),
            canvasArea: document.getElementById('canvas-area'),
            btnChrome: document.getElementById('btn-chrome'),
            btnDark: document.getElementById('btn-dark'),
            leftPanel: document.getElementById('left-panel'),
            rightPanel: document.getElementById('right-panel'),
            leftToggleBtn: document.getElementById('left-toggle-btn'),
            rightToggleBtn: document.getElementById('right-toggle-btn'),
            leftChevron: document.getElementById('left-chevron'),
            rightChevron: document.getElementById('right-chevron'),
            mobileLeftBtn: document.getElementById('mobile-left-btn'),
            mobileRightBtn: document.getElementById('mobile-right-btn')
        };

        // --- Initialization ---
        function init() {
            // Check Screen size to collapse sidebars on mobile
            if (window.innerWidth < 768) {
                state.leftPanelOpen = false;
                state.rightPanelOpen = false;
            } else {
                state.leftPanelOpen = true;
                state.rightPanelOpen = true;
            }

            loadTemplate('gradient-card');
            updateStyle('padding', 48);
            updateStyle('radius', 12);
            setBg(state.bg);
            setShadow('xl');

            updatePanelState();
            syncChromeUI();
            highlightShadowBtn('xl');

            // Initial Auto-Fit
            setTimeout(fitContent, 100);
        }

        // --- Panel Logic ---
        function toggleLeftPanel() {
            state.leftPanelOpen = !state.leftPanelOpen;
            // On mobile, if opening left, close right
            if (window.innerWidth < 768 && state.leftPanelOpen) {
                state.rightPanelOpen = false;
            }
            updatePanelState();
        }

        function toggleRightPanel() {
            state.rightPanelOpen = !state.rightPanelOpen;
            // On mobile, if opening right, close left
            if (window.innerWidth < 768 && state.rightPanelOpen) {
                state.leftPanelOpen = false;
            }
            updatePanelState();
        }

        function updatePanelState() {
            const isDesktop = window.innerWidth >= 768;

            // Left Panel
            if (state.leftPanelOpen) {
                els.leftPanel.classList.remove('w-0', 'border-none');
                els.leftPanel.classList.add('w-80', 'border-r');
                els.leftChevron.className = 'fa-solid fa-chevron-left text-[10px]';
                // Mobile Button Active State
                els.mobileLeftBtn.classList.add('text-blue-500');
                els.mobileLeftBtn.classList.remove('text-gray-400');
            } else {
                els.leftPanel.classList.add('w-0', 'border-none');
                els.leftPanel.classList.remove('w-80', 'border-r');
                els.leftChevron.className = 'fa-solid fa-chevron-right text-[10px]';
                // Mobile Button Inactive State
                els.mobileLeftBtn.classList.remove('text-blue-500');
                els.mobileLeftBtn.classList.add('text-gray-400');
            }

            // Left Button Position
            els.leftToggleBtn.style.left = (state.leftPanelOpen) ? '320px' : '0';

            // Right Panel
            if (state.rightPanelOpen) {
                els.rightPanel.classList.remove('w-0', 'border-none');
                els.rightPanel.classList.add('w-80', 'border-l');
                els.rightChevron.className = 'fa-solid fa-chevron-right text-[10px]';
                // Mobile Button Active State
                els.mobileRightBtn.classList.add('text-blue-500');
                els.mobileRightBtn.classList.remove('text-gray-400');
            } else {
                els.rightPanel.classList.add('w-0', 'border-none');
                els.rightPanel.classList.remove('w-80', 'border-l');
                els.rightChevron.className = 'fa-solid fa-chevron-left text-[10px]';
                // Mobile Button Inactive State
                els.mobileRightBtn.classList.remove('text-blue-500');
                els.mobileRightBtn.classList.add('text-gray-400');
            }

            // Right Button Position
            els.rightToggleBtn.style.right = (state.rightPanelOpen) ? '320px' : '0';

            // Trigger auto-fit when panels move (desktop only mostly)
            if (isDesktop) setTimeout(fitContent, 350);
        }

        // --- Core ---
        els.input.addEventListener('input', () => {
            if (state.mode === 'editor') {
                renderContent(els.input.value);
            }
        });

        function renderContent(html) {
            els.output.innerHTML = html;
            if (html.includes('<code')) {
                Prism.highlightAllUnder(els.output);
            }
        }

        function loadTemplate(key) {
            // Force editor mode if template clicked
            if (state.mode === 'url') setMode('editor');

            const tpl = templates[key] || templates['default'];
            els.input.value = tpl;
            renderContent(tpl);
            setTimeout(fitContent, 50);
        }

        function formatCode() {
            let code = els.input.value;
            els.input.value = code.trim();
            showToast('Code Formatted', 'success');
        }

        function updateStyle(prop, val) {
            state[prop] = val;
            if (prop === 'padding') {
                els.output.style.padding = `${val}px`;
                document.getElementById('val-padding').innerText = `${val}px`;
            }
            if (prop === 'radius') {
                els.container.style.borderRadius = `${val}px`;
                document.getElementById('val-radius').innerText = `${val}px`;
            }
        }

        function setBg(color) {
            state.bg = color;
            els.container.style.background = color;
        }

        function setPattern(patternClass) {
            const layer = document.getElementById('bg-pattern-layer');
            layer.className = 'absolute inset-0 pointer-events-none opacity-50 z-0 ' + (patternClass === 'none' ? '' : patternClass);
        }

        function updateFont(font) {
            els.container.style.fontFamily = font;
        }

        function setShadow(size) {
            const map = {
                'none': 'none',
                'md': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                'xl': '0 25px 50px -12px rgba(0, 0, 0, 0.5)'
            };
            els.container.style.boxShadow = map[size];
            highlightShadowBtn(size);
        }

        function highlightShadowBtn(activeSize) {
            ['none', 'md', 'xl'].forEach(size => {
                const btn = document.getElementById(`shadow-${size}`);
                if (size === activeSize) {
                    btn.classList.add('bg-[#333]', 'text-white', 'border-gray-500');
                    btn.classList.remove('text-gray-400', 'border-[#333]');
                } else {
                    btn.classList.remove('bg-[#333]', 'text-white', 'border-gray-500');
                    btn.classList.add('text-gray-400', 'border-[#333]');
                }
            });
        }

        function setScale(scale) {
            state.scale = scale;
            [1, 2, 4].forEach(s => {
                const btn = document.getElementById(`scale-${s}`);
                if (s === scale) {
                    btn.className = 'flex-1 py-1.5 text-[10px] bg-blue-600 border border-blue-500 rounded text-white font-bold transition-colors';
                } else {
                    btn.className = 'flex-1 py-1.5 text-[10px] bg-[#151515] border border-[#333] rounded hover:border-gray-500 text-gray-400 hover:text-white transition-colors';
                }
            });
            showToast(`Export Quality: ${scale}x`, 'info');
        }

        // --- Window Chrome Logic ---
        function toggleWindowChrome() {
            state.chrome = !state.chrome;
            syncChromeUI();
        }

        function toggleDarkMode() {
            state.darkChrome = !state.darkChrome;
            syncChromeUI();
        }

        function syncChromeUI() {
            const title = document.getElementById('window-title');

            // Visibility
            if (state.chrome) {
                els.chrome.classList.remove('hidden');
                moveToggle('btn-chrome', true);
            } else {
                els.chrome.classList.add('hidden');
                moveToggle('btn-chrome', false);
            }

            // Colors
            if (state.darkChrome) {
                els.chrome.classList.add('bg-[#1a1a1a]', 'border-white/5');
                els.chrome.classList.remove('bg-white', 'border-gray-200');
                title.classList.remove('text-gray-600');
                title.classList.add('text-gray-500');
                moveToggle('btn-dark', true);
            } else {
                els.chrome.classList.remove('bg-[#1a1a1a]', 'border-white/5');
                els.chrome.classList.add('bg-white', 'border-gray-200');
                title.classList.add('text-gray-600');
                title.classList.remove('text-gray-500');
                moveToggle('btn-dark', false);
            }
        }

        function moveToggle(id, active) {
            const btn = document.getElementById(id);
            const knob = btn.querySelector('div');
            if (active) {
                btn.classList.add('bg-blue-600');
                btn.classList.remove('bg-[#333]');
                knob.classList.add('translate-x-3', 'md:translate-x-4');
            } else {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-[#333]');
                knob.classList.remove('translate-x-3', 'md:translate-x-4');
            }
        }

        // --- Tilt Logic ---
        function toggleTilt() {
            state.tilt = !state.tilt;
            const btn = document.getElementById('btn-tilt');

            if (state.tilt) {
                btn.classList.add('text-blue-400', 'border-blue-500/50', 'bg-blue-500/10');
                btn.classList.remove('text-gray-400', 'border-[#222]');
                document.addEventListener('mousemove', handleTilt);
                showToast('3D Mode: Active', 'info');
            } else {
                btn.classList.remove('text-blue-400', 'border-blue-500/50', 'bg-blue-500/10');
                btn.classList.add('text-gray-400', 'border-[#222]');
                document.removeEventListener('mousemove', handleTilt);
                applyZoom(); // Reset tilt
            }
        }

        function handleTilt(e) {
            if (!state.tilt) return;
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;
            const dx = e.clientX - cx;
            const dy = e.clientY - cy;

            const tiltX = -(dy / cy) * 5;
            const tiltY = (dx / cx) * 5;

            els.scaleWrapper.style.transform = `scale(${state.zoom}) rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
        }

        // --- Auto-Fit Engine ---
        function fitContent() {
            if (!els.canvasArea || !els.container) return;

            // Get available space
            const areaW = els.canvasArea.clientWidth;
            const areaH = els.canvasArea.clientHeight;

            // Get content dimensions (default 800 width)
            const contentW = 800; // Fixed width for container
            const contentH = els.container.scrollHeight > 400 ? els.container.scrollHeight : 400; // Min height 400

            // Padding
            const pad = 40;

            // Calculate scale needed
            const scaleX = (areaW - pad) / contentW;
            const scaleY = (areaH - pad) / contentH;

            // Choose smaller scale to fit
            let scale = Math.min(scaleX, scaleY);

            // Logic:
            // 1. If screen is smaller than content (scale < 1), shrink it.
            // 2. If screen is huge, limit max zoom to 1.2 or 1.5 to prevent pixelation? 
            //    Actually, for "fitting", we usually max at 1.0 unless user zooms in manually.
            if (scale > 1) scale = 1;
            if (scale < 0.2) scale = 0.2;

            // Update state
            state.zoom = scale;
            applyZoom();
        }

        // --- Export ---
        async function generateBlob() {
            const wrapper = els.scaleWrapper;
            const oldTransform = wrapper.style.transform;
            wrapper.style.transform = 'scale(1)';
            await new Promise(r => setTimeout(r, 50));

            try {
                const blob = await htmlToImage.toBlob(els.container, {
                    pixelRatio: state.scale,
                    useCORS: true,
                    backgroundColor: 'transparent'
                });

                applyZoom(); // Restore view

                return blob;
            } catch (error) {
                wrapper.style.transform = oldTransform;
                console.error(error);
                throw error;
            }
        }

        function exportImage() {
            showToast(`Rendering at ${state.scale}x...`, 'info');
            generateBlob().then(blob => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `snapcode-${Date.now()}.png`;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
                showToast('Image Downloaded!', 'success');
            }).catch(() => showToast('Export Failed', 'error'));
        }

        function copyToClipboard() {
            showToast('Copying...', 'info');
            generateBlob().then(blob => {
                navigator.clipboard.write([
                    new ClipboardItem({ 'image/png': blob })
                ]).then(() => showToast('Copied to Clipboard!', 'success'));
            }).catch(() => showToast('Failed to copy', 'error'));
        }

        // --- View Logic ---
        function updateZoom(delta) {
            let newZoom = Math.round((state.zoom + delta) * 10) / 10;
            if (newZoom < 0.2) newZoom = 0.2;
            if (newZoom > 2.0) newZoom = 2.0;
            state.zoom = newZoom;
            applyZoom();
        }

        function applyZoom() {
            document.getElementById('zoom-label').innerText = Math.round(state.zoom * 100) + '%';
            if (!state.tilt) {
                els.scaleWrapper.style.transform = `scale(${state.zoom})`;
            }
        }

        function resizeCanvas(w, h) {
            els.container.style.width = w === 'auto' ? 'auto' : `${w}px`;

            if (h !== 'auto') {
                els.container.style.height = `${h}px`;
                els.container.style.minHeight = '0';
            } else {
                els.container.style.height = 'auto';
                els.container.style.minHeight = '400px';
            }

            document.getElementById('input-width').value = w === 'auto' ? 800 : w;

            // Auto fit after resize
            setTimeout(fitContent, 50);
        }

        function updateDimensions() {
            resizeCanvas(document.getElementById('input-width').value, 'auto');
        }

        function setMode(mode) {
            state.mode = mode;
            const htmlTab = document.getElementById('btn-mode-editor');
            const urlTab = document.getElementById('btn-mode-url');

            if (mode === 'url') {
                els.urlInputBar.classList.remove('hidden');

                // Style Tabs
                urlTab.classList.add('bg-[#252525]', 'text-white', 'shadow-sm', 'ring-1', 'ring-white/5');
                urlTab.classList.remove('text-gray-500');
                htmlTab.classList.remove('bg-[#252525]', 'text-white', 'shadow-sm', 'ring-1', 'ring-white/5');
                htmlTab.classList.add('text-gray-500');

                // Auto collapse Left, Open Right
                state.leftPanelOpen = false;
                state.rightPanelOpen = true;
                updatePanelState();

            } else {
                els.urlInputBar.classList.add('hidden');

                // Style Tabs
                htmlTab.classList.add('bg-[#252525]', 'text-white', 'shadow-sm', 'ring-1', 'ring-white/5');
                htmlTab.classList.remove('text-gray-500');
                urlTab.classList.remove('bg-[#252525]', 'text-white', 'shadow-sm', 'ring-1', 'ring-white/5');
                urlTab.classList.add('text-gray-500');

                // Restore Editor Content
                renderContent(els.input.value);

                // Auto Open Left on desktop when switching back
                if (window.innerWidth >= 768) {
                    state.leftPanelOpen = true;
                    updatePanelState();
                }
            }
        }

        function fetchUrlScreenshot() {
            let url = document.getElementById('url-input').value.trim();
            if (!url) return showToast('Enter a URL first', 'error');

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }

            const loadingBar = document.getElementById('url-loading-bar');
            loadingBar.classList.remove('hidden');

            // Primary: WordPress mShots
            const mShotsUrl = `https://s0.wp.com/mshots/v1/${encodeURIComponent(url)}?w=1200&v=${Date.now()}`;
            const thumIoUrl = `https://image.thum.io/get/width/1200/crop/800/noanimate/${url}`;

            const tryLoadImage = (src, timeout = 8000) => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    let timer = setTimeout(() => {
                        img.src = "";
                        reject(new Error("Timeout"));
                    }, timeout);

                    img.onload = () => {
                        clearTimeout(timer);
                        resolve(src);
                    };

                    img.onerror = () => {
                        clearTimeout(timer);
                        reject(new Error("Load Error"));
                    };
                    img.src = src;
                });
            };

            const displayImage = (src) => {
                // Update Window Title with URL
                document.getElementById('window-title').innerText = url.replace(/(^\w+:|^)\/\//, '').split('/')[0];

                // Inject into Content Area
                els.output.innerHTML = `<div class="w-full h-full flex items-center justify-center overflow-hidden"><img src="${src}" class="w-full h-auto shadow-sm" crossorigin="anonymous" style="display: block;"></div>`;

                loadingBar.classList.add('hidden');
                // Hide input bar to show result better
                els.urlInputBar.classList.add('hidden');

                // Refit content for new image
                setTimeout(fitContent, 100);
            };

            (async () => {
                try {
                    await tryLoadImage(mShotsUrl);
                    displayImage(mShotsUrl);
                } catch (error) {
                    console.warn("Primary failed, trying fallback...", error);
                    try {
                        await tryLoadImage(thumIoUrl);
                        displayImage(thumIoUrl);
                        showToast('Using fallback provider', 'info');
                    } catch (fallbackError) {
                        console.error("Fallback failed", fallbackError);
                        loadingBar.classList.add('hidden');
                        showToast('Could not load preview. Site may be blocking bots.', 'error');
                    }
                }
            })();
        }

        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;

            const iconContainer = document.getElementById('toast-icon-container');
            const icon = iconContainer.querySelector('i');

            if (type === 'info') {
                iconContainer.className = 'w-5 h-5 md:w-6 md:h-6 rounded-full bg-blue-500/20 flex items-center justify-center';
                icon.className = 'fa-solid fa-circle-notch fa-spin text-blue-500 text-[10px] md:text-xs';
            } else if (type === 'error') {
                iconContainer.className = 'w-5 h-5 md:w-6 md:h-6 rounded-full bg-red-500/20 flex items-center justify-center';
                icon.className = 'fa-solid fa-triangle-exclamation text-red-500 text-[10px] md:text-xs';
            } else {
                iconContainer.className = 'w-5 h-5 md:w-6 md:h-6 rounded-full bg-green-500/20 flex items-center justify-center';
                icon.className = 'fa-solid fa-check text-green-500 text-[10px] md:text-xs';
            }

            t.classList.remove('translate-x-full');
            if (window.toastTimer) clearTimeout(window.toastTimer);
            window.toastTimer = setTimeout(() => t.classList.add('translate-x-full'), 3000);
        }

        // Run
        init();

        // Handle window resize
        window.addEventListener('resize', () => {
            updatePanelState();
            fitContent(); // Auto-fit on resize
        });

    </script>
</body>

</html>